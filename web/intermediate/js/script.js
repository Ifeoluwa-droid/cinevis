var xField="Budget",yField="Worldwide Gross",xScale,yScale,xAxis,yAxis,xAxisPanel,yAxisPanel,xLegend,yLegend,redBlue="rgb(103, 0, 31);rgb( 178, 24, 43);rgb( 214, 96, 77);rgb( 244, 165, 130);rgb( 253, 219, 199);rgb( 209, 229, 240);rgb( 146, 197, 222);rgb( 67, 147, 195);rgb( 33, 102, 172);rgb( 5, 48, 97)".split(";"),brownBlueGreen="rgb(84, 48, 5);rgb( 140, 81, 10);rgb( 191, 129, 45);rgb( 223, 129, 125);rgb( 246, 232, 195);rgb( 199, 234, 229);rgb( 128, 205, 193);rgb( 53, 151, 143);rgb( 1, 102, 94);rgb( 0, 60, 48)".split(";"),
purpleGreen="rgb(64, 0, 75);rgb( 118, 42, 131);rgb( 153, 112, 171);rgb( 194, 165, 207);rgb( 231, 212, 232);rgb( 217, 240, 211);rgb( 166, 219, 160);rgb( 90, 174, 97);rgb( 27, 120, 55);rgb( 0, 68, 27)".split(";"),redYellowBlue="rgb(165, 0, 38);rgb( 215, 48, 39);rgb( 244, 109, 67);rgb( 253, 174, 97);rgb( 254, 224, 144);rgb( 224, 243, 248);rgb( 171, 217, 233);rgb( 116, 173, 209);rgb( 69, 117, 180);rgb( 49, 54, 149)".split(";"),purpleOrange="rgb(127, 59, 8);rgb( 179, 88, 6);rgb( 224, 130, 20);rgb( 253, 184, 99);rgb( 254, 224, 182);rgb( 216, 218, 235);rgb( 178, 171, 210);rgb( 128, 115, 172);rgb( 84, 39, 136);rgb( 45, 0, 75)".split(";"),
palettes=[redBlue,brownBlueGreen,purpleGreen,redYellowBlue,purpleOrange],currentPaletteIndex=0,currentPalette=palettes[currentPaletteIndex],colorField="Story",categoricalFields=["Story","Genre","Lead Studio"],categoricalColorScale=d3.scale.category20c(),numericColorScale=d3.scale.quantile().range(currentPalette),colorScale=$.inArray(colorField,categoricalFields)>=0?categoricalColorScale:numericColorScale,data,averages,svg,numberFormat=d3.format(",.2f"),intFormat=d3.format(","),percentFormat=d3.format(",p"),
domain=function(a,b){if(arguments.length>1){var c=[d3.min(data,function(a){return $.isNumeric(a[b])?+a[b]:0}),d3.max(data,function(a){return $.isNumeric(a[b])?+a[b]:0})];a==="x"?this.xDomain=c:this.yDomain=c}return a==="x"?this.xDomain:this.yDomain},locate=function(a,b){var c,d;b==="x"?(c=a[xField],d=xScale):(c=a[yField],d=yScale);return $.isNumeric(c)?d(c):domain(b)[0]},colorize=function(a){return colorField!=="None"?colorScale(a[colorField]):null};
d3.json("/data/moviedata.json",function(a){data=a;var a=d3.min(data,function(a){return $.isNumeric(a.Profitability)?+a.Profitability:0}),b=d3.max(data,function(a){return $.isNumeric(a.Profitability)?+a.Profitability:0});$("#profit-slider").slider({min:a,max:b,values:[a,b]});$("#profit-slider-text").val($("#profit-slider").slider("values",0)+" - "+$("#profit-slider").slider("values",1));var a=$("#vis").width(),b=$("#vis").height(),c=[0,a-65],d=[b-65,0];domain("x",xField);domain("y",yField);xScale=
d3.scale.linear().domain(domain("x")).range(c);yScale=d3.scale.linear().domain(domain("y")).range(d);xAxis=d3.svg.axis().scale(xScale).orient("bottom").ticks(5).tickSize(-(b-65),0,0).tickFormat(intFormat);yAxis=d3.svg.axis().orient("left").scale(yScale).ticks(5).tickSize(-(a-65),0,0).tickFormat(intFormat);svg=d3.select("#vis").append("svg").attr("width",a).attr("height",b).append("g").attr("transform","translate(55,10)");xAxisPanel=svg.append("g").attr("class","x axis").attr("id","xTicks").attr("transform",
"translate(0,"+(b-65)+")").call(xAxis);xLegend=svg.append("text").attr("id","xLabel").attr("x",a/2).attr("y",b-65/3).attr("text-anchor","middle").attr("class","axisTitle").text(xField);yAxisPanel=svg.append("g").attr("class","y axis").attr("id","yTicks").attr("transform","translate(0,0)").call(yAxis);yLegend=svg.append("text").attr("id","yLabel").attr("x",b/2).attr("y",65/3).attr("text-anchor","end").attr("class","axisTitle").attr("transform","translate(-65,"+b*0.85+")rotate(-90)").text(yField);svg.selectAll("circle").data(data).enter().append("circle").attr("class",
"point").attr("cx",function(a){return locate(a,"x")}).attr("cy",function(a){return locate(a,"y")}).attr("r",6).style("fill",function(a){return colorize(a)}).on("mouseover",mouseover).on("mouseout",mouseout)});
function mouseover(a){$("#details").css("display","inline");$("#detail-film-value").html(a.Film);$("#detail-year-value").html(a.Year);$("#detail-profitability-value").html(percentFormat(a.Profitability));$("#detail-budget-value").html("$ "+numberFormat(a.Budget)+"M");$("#detail-worldwide-value").html("$ "+numberFormat(a["Worldwide Gross"])+"M");$("#detail-domestic-value").html("$ "+numberFormat(a["Domestic Gross"])+"M");$("#detail-foreign-value").html("$ "+numberFormat(a["Foreign Gross"])+"M");$("#detail-audience-value").html(a["Audience Rating"]);
$("#detail-rotten-value").html(a["Critic Rating"]);$("#detail-theatres-value").html(intFormat(a["Opening Weekend Theaters"]));$("#detail-openingweekend-value").html("$ "+numberFormat(a["Opening Weekend Revenue"])+"M");$("#detail-avgcinema-value").html("$ "+numberFormat(a["Opening Weekend per Cinema"]));$("#detail-genre-value").html(a.Genre);$("#detail-story-value").html(a.Story);$("#detail-oscar-value").html(a.Oscar);$("#detail-studio-value").html(a["Lead Studio"]);d3.select(this).style("stroke-width",
2.5).style("stroke","orange").style("stroke-opacity",1).style("fill-opacity",1)}function mouseout(){d3.select(this).style("stroke-width",null).style("stroke",null).style("stroke-opacity",null).style("fill-opacity",null)}
$(function(){$("#profit-slider").slider({range:!0,min:0,max:100,values:[0,100],slide:function(a,b){$("#profit-slider-text").val(+b.values[0]+" - "+b.values[1])}});$("#profit-slider-text").val($("#profit-slider").slider("values",0)+" - "+$("#profit-slider").slider("values",1));$("#xaxis").val(xField);$("#yaxis").val(yField);$("#color").val(colorField);$("#xaxis").change(function(){xField=$("#xaxis").val();domain("x",xField);xScale.domain(domain("x"));xAxis.scale(xScale);svg.select("#xTicks").call(xAxis);
svg.select("#xLabel").text(xField);redraw()});$("#yaxis").change(function(){yField=$("#yaxis").val();domain("y",yField);yScale.domain(domain("y"));yAxis.scale(yScale);svg.select("#yTicks").call(yAxis);svg.select("#yLabel").text(yField);redraw()});$("#color").change(function(){colorField=$("#color").val();colorScale=$.inArray(colorField,categoricalFields)>=0?categoricalColorScale:numericColorScale.domain([d3.min(data,function(a){return a[colorField]}),d3.sum(data,function(a){return a[colorField]})/
data.length,d3.max(data,function(a){return a[colorField]})]);redraw()});$("#profit-slider").on("slidestop",function(a,b){console.log("Filter out profitability values not in range: "+b.values[0]+" / "+b.values[1])})});function redraw(){svg.selectAll("circle").data(data).transition().duration(1E3).attr("cx",function(a){return locate(a,"x")}).attr("cy",function(a){return locate(a,"y")}).style("fill",function(a){return colorize(a)})};
